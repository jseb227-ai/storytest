import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import t from"classnames";import i,{forwardRef as s,useRef as r,useState as a,useCallback as n,useMemo as l}from"react";import{camelCase as c,noop as d,isFunction as m}from"es-toolkit";import{getStyle as p}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as u,ComponentDefaultTestId as v}from"../../tests/testIds.js";import b from"../../hooks/useMergeRef.js";import f from"../Search/Search.js";import{BASE_SIZES as h}from"../../constants/sizes.js";import C from"../Button/Button.js";import g from"../Text/Text.js";import x from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as y}from"./ComboboxService.js";import{ComboboxItems as I}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as O}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as N,useKeyboardNavigation as j}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as S}from"./helpers.js";import{withStaticProps as R}from"../../types/withStaticProps.js";import"../../utils/colors-vars-map.js";import{COMBOBOX_LISTBOX_ID as k}from"./components/ComboboxConstants.js";import F from"./Combobox.module.scss.js";import{ComponentVibeId as H}from"../../tests/constants.js";var E=R(s((function(s,h){var x=s.className,R=void 0===x?"":x,E=s.optionClassName,A=void 0===E?"":E,L=s.searchWrapperClassName,M=s.stickyCategoryClassName,B=s.searchIcon,w=s.id,T=void 0===w?"":w,z=s.placeholder,V=void 0===z?"":z,W=s.size,P=void 0===W?"medium":W,D=s.defaultVisualFocusFirstIndex,X=s.optionLineHeight,_=void 0===X?32:X,q=s.optionsListHeight,G=s.autoFocus,J=void 0!==G&&G,K=s.disabled,Q=void 0!==K&&K,U=s.options,Y=void 0===U?[]:U,Z=s.categories,$=s.withCategoriesDivider,ee=void 0!==$&&$,oe=s.noResultsMessage,te=void 0===oe?"No results found":oe,ie=s.onAddNew,se=s.addNewLabel,re=void 0===se?"Add new":se,ae=s.onClick,ne=void 0===ae?function(e){}:ae,le=s.filter,ce=void 0===le?y:le,de=s.disableFilter,me=void 0!==de&&de,pe=s.filterValue,ue=s.onFilterChanged,ve=s.loading,be=void 0!==ve&&ve,fe=s.onOptionHover,he=void 0===fe?d:fe,Ce=s.onOptionLeave,ge=void 0===Ce?d:Ce,xe=s.shouldScrollToSelectedItem,ye=void 0===xe||xe,Ie=s.noResultsRenderer,Oe=s.stickyCategories,Ne=void 0!==Oe&&Oe,je=s.optionRenderer,Se=void 0===je?null:je,Re=s.renderOnlyVisibleOptions,ke=void 0!==Re&&Re,Fe=s.clearFilterOnSelection,He=void 0!==Fe&&Fe,Ee=s.maxOptionsWithoutScroll,Ae=s.defaultFilter,Le=void 0===Ae?"":Ae,Me=s.searchInputAriaLabel,Be=void 0===Me?"Search for content":Me,we=s["data-testid"],Te=s.debounceRate,ze=s.searchInputRef,Ve=s.renderAction,We=s.hideRenderActionOnInput,Pe=r(null),De=r(null),Xe=b(h,Pe),_e=b(De,ze),qe=a(pe||Le),Ge=e(qe,2),Je=Ge[0],Ke=Ge[1];void 0!==pe&&pe!==Je&&Ke(pe);var Qe=n((function(e){oo(-1),ue&&ue(e),Ke(e)}),[Ke,ue]),Ue=n((function(e,o,t){he(e,o,t)}),[he]),Ye=l((function(){return me?Y:ce(Je,Y)}),[Y,Je,ce,me]),Ze=a(-1),$e=e(Ze,2),eo=$e[0],oo=$e[1],to=n((function(e){return void 0!==e&&Ye[e]&&!Ye[e].disabled}),[Ye]),io=n((function(){ie&&ie(Je),Ke("")}),[ie,Je,Ke]),so=Ye.length>0,ro=Je.length>0;var ao=a(),no=e(ao,2),lo=no[0],co=no[1],mo=n((function(e){var o;(null===(o=null==e?void 0:e.category)||void 0===o?void 0:o.label)!==(null==lo?void 0:lo.label)&&co(null==e?void 0:e.category)}),[lo]),po=N({categories:Z,options:Ye,filterValue:Je,withCategoriesDivider:ee,optionLineHeight:_}),uo=po.items,vo=po.itemsMap,bo=po.selectableItems,fo=n((function(e,o){ne(bo[o]),to(o)&&oo(o),He&&Qe("")}),[ne,bo,to,He,Qe]),ho=j({getOptionId:S,defaultVisualFocusFirstIndex:D,onClick:fo,isChildSelectable:to,options:bo,inputRef:_e}),Co=ho.visualFocusItemIndex,go=ho.visualFocusItemId,xo=ho.onOptionClick;return i.createElement(g,{type:"text2",ref:Xe,className:t(F.combobox,R,p(F,c("size-"+P)),o(o({},F.empty,!so),F.stickyCategory,Ne)),id:T,"data-testid":we||u(v.COMBOBOX,T),ellipsis:!1,"data-vibe":H.COMBOBOX},i.createElement("div",{className:F.comboboxList,style:{maxHeight:q}},i.createElement(f,{ref:_e,value:Je,className:t(F.comboboxSearchWrapper,L),inputAriaLabel:Be,currentAriaResultId:go,id:"combobox-search",placeholder:V,size:P,disabled:Q,onChange:Qe,autoFocus:J,loading:be,searchIconName:B,ariaExpanded:ro||so,ariaHasPopup:"listbox",searchResultsContainerId:T?"".concat(T,"-listbox"):k,debounceRate:Te,renderAction:Ve,hideRenderActionOnInput:We}),Ne&&i.createElement(O,{label:null==lo?void 0:lo.label,color:null==lo?void 0:lo.color,className:M}),so&&i.createElement(I,{stickyCategories:Ne,categories:Z,options:uo,itemsMap:vo,optionClassName:A,optionRenderer:Se,activeItemIndex:eo,onActiveCategoryChanged:mo,onOptionClick:xo,onOptionEnter:Ue,onOptionLeave:ge,optionLineHeight:_,shouldScrollToSelectedItem:ye,renderOnlyVisibleOptions:ke,maxOptionsWithoutScroll:Ee,visualFocusItemIndex:Co,id:T?"".concat(T,"-listbox"):k})),ro&&!so&&!be&&(Ie?Ie():i.createElement("div",{className:F.comboboxNoResults},i.createElement("div",{className:F.comboboxMessageWrapper},i.createElement("span",{className:F.comboboxMessage},te)),ie&&!Q&&i.createElement(C,{className:F.addNewButton,size:P,kind:"tertiary",onClick:io},i.createElement("span",{className:F.buttonLabel},m(re)?re(Je):re)))))})),{sizes:h,iconTypes:x.iconTypes});export{E as default};
//# sourceMappingURL=Combobox.js.map
