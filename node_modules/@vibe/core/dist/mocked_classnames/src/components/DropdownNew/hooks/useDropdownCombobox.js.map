{"version":3,"file":"useDropdownCombobox.js","sources":["../../../../../../src/components/DropdownNew/hooks/useDropdownCombobox.ts"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport { useCombobox } from \"downshift\";\nimport useDropdownFiltering from \"./useDropdownFiltering\";\nimport { type BaseListItemData } from \"../../BaseListItem\";\nimport { type DropdownGroupOption } from \"../Dropdown.types\";\n\nfunction useDropdownCombobox<T extends BaseListItemData<Record<string, unknown>>>(\n  options: DropdownGroupOption<T>,\n  isMenuOpen?: boolean,\n  autoFocus?: boolean,\n  closeMenuOnSelect?: boolean,\n  defaultValue?: T,\n  value?: T,\n  inputValueProp?: string,\n  onChange?: (option: T | T[] | null) => void,\n  onInputChange?: (value: string) => void,\n  onMenuOpen?: () => void,\n  onMenuClose?: () => void,\n  onOptionSelect?: (option: T) => void,\n  filterOption?: (option: T, inputValue: string) => boolean,\n  showSelectedOptions?: boolean\n) {\n  const [currentSelectedItem, setCurrentSelectedItem] = useState<T | null>(defaultValue || null);\n\n  // Use controlled value if provided, otherwise use internal state\n  const selectedItem = value !== undefined ? value : currentSelectedItem;\n\n  const memoizedSelectedItemForFiltering = useMemo(() => {\n    return selectedItem ? [selectedItem] : [];\n  }, [selectedItem]);\n\n  const { filteredOptions, filterOptions } = useDropdownFiltering<T>(\n    options,\n    filterOption,\n    showSelectedOptions,\n    memoizedSelectedItemForFiltering\n  );\n\n  const flatOptions = useMemo(() => filteredOptions.flatMap(group => group.options), [filteredOptions]);\n  const {\n    isOpen,\n    inputValue,\n    highlightedIndex,\n    getToggleButtonProps,\n    getLabelProps,\n    getMenuProps,\n    getInputProps,\n    getItemProps,\n    reset,\n    openMenu,\n    toggleMenu,\n    closeMenu\n  } = useCombobox<T>({\n    items: flatOptions,\n    itemToString: item => item?.label ?? \"\",\n    isItemDisabled: item => Boolean(item.disabled),\n    initialInputValue: inputValueProp || \"\",\n    selectedItem: selectedItem,\n    isOpen: isMenuOpen,\n    initialIsOpen: autoFocus,\n    onIsOpenChange: ({ isOpen }) => {\n      isOpen ? onMenuClose?.() : onMenuOpen?.();\n    },\n\n    onInputValueChange: useCallback(\n      ({ inputValue }) => {\n        filterOptions(inputValue || \"\");\n        onInputChange?.(inputValue || \"\");\n      },\n      [onInputChange, filterOptions]\n    ),\n    onSelectedItemChange: useCallback(\n      ({ selectedItem }) => {\n        if (value === undefined) {\n          setCurrentSelectedItem(selectedItem || null);\n        }\n        if (selectedItem) {\n          onOptionSelect?.(selectedItem);\n          onChange?.(selectedItem);\n          filterOptions(\"\");\n        } else {\n          onChange?.(null);\n          filterOptions(\"\");\n        }\n      },\n      [value, onOptionSelect, filterOptions, onChange]\n    ),\n    stateReducer: (state, actionAndChanges) => {\n      switch (actionAndChanges.type) {\n        case useCombobox.stateChangeTypes.InputKeyDownEnter:\n        case useCombobox.stateChangeTypes.ItemClick:\n          return { ...actionAndChanges.changes, inputValue: \"\", isOpen: !closeMenuOnSelect };\n        case useCombobox.stateChangeTypes.InputBlur:\n          return { ...actionAndChanges.changes, inputValue: \"\" };\n\n        default:\n          return actionAndChanges.changes;\n      }\n    }\n  });\n\n  return {\n    isOpen,\n    inputValue,\n    highlightedIndex,\n    selectedItem,\n    getToggleButtonProps,\n    getLabelProps,\n    getMenuProps,\n    getInputProps,\n    getItemProps,\n    reset: () => {\n      if (value === undefined) {\n        setCurrentSelectedItem(null);\n      }\n      reset();\n      filterOptions(\"\");\n    },\n    filteredOptions,\n    openMenu,\n    toggleMenu,\n    closeMenu\n  };\n}\n\nexport default useDropdownCombobox;\n"],"names":["useDropdownCombobox","options","isMenuOpen","autoFocus","closeMenuOnSelect","defaultValue","value","inputValueProp","onChange","onInputChange","onMenuOpen","onMenuClose","onOptionSelect","filterOption","showSelectedOptions","_useState","useState","_useState2","_slicedToArray","setCurrentSelectedItem","selectedItem","undefined","memoizedSelectedItemForFiltering","useMemo","_useDropdownFiltering","useDropdownFiltering","filteredOptions","filterOptions","flatOptions","flatMap","group","_useCombobox","useCombobox","items","itemToString","item","_a","label","isItemDisabled","disabled","initialInputValue","isOpen","initialIsOpen","onIsOpenChange","_ref","onInputValueChange","useCallback","_ref2","inputValue","onSelectedItemChange","_ref3","stateReducer","state","actionAndChanges","type","stateChangeTypes","InputKeyDownEnter","ItemClick","Object","assign","changes","InputBlur","reset","highlightedIndex","getToggleButtonProps","getLabelProps","getMenuProps","getInputProps","getItemProps","openMenu","toggleMenu","closeMenu"],"mappings":"kOAMA,SAASA,EACPC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,IAAAC,EAAsDC,EAAmBX,GAAgB,MAAKY,EAAAC,EAAAH,EAAA,GAAlEI,EAAsBF,EAAA,GAG5CG,OAAyBC,IAAVf,EAAsBA,EAHjBW,EAAA,GAKpBK,EAAmCC,GAAQ,WAC/C,OAAOH,EAAe,CAACA,GAAgB,EACzC,GAAG,CAACA,IAEJI,EAA2CC,EACzCxB,EACAY,EACAC,EACAQ,GAJMI,EAAeF,EAAfE,gBAAiBC,EAAaH,EAAbG,cAOnBC,EAAcL,GAAQ,WAAA,OAAMG,EAAgBG,SAAQ,SAAAC,GAAK,OAAIA,EAAM7B,aAAU,CAACyB,IACpFK,EAaIC,EAAe,CACjBC,MAAOL,EACPM,aAAc,SAAAC,GAAO,IAAAC,EAAC,OAAe,QAAfA,EAAAD,eAAAA,EAAME,aAAS,IAAAD,EAAAA,EAAA,EAAE,EACvCE,eAAgB,SAAAH,GAAI,QAAYA,EAAKI,QAAS,EAC9CC,kBAAmBjC,GAAkB,GACrCa,aAAcA,EACdqB,OAAQvC,EACRwC,cAAevC,EACfwC,eAAgB,SAAAC,GAASA,EAANH,OACR9B,SAAAA,IAAkBD,SAAAA,GAC5B,EAEDmC,mBAAoBC,GAClB,SAAAC,GAAmB,IAAhBC,EAAUD,EAAVC,WACDrB,EAAcqB,GAAc,IAC5BvC,SAAAA,EAAgBuC,GAAc,GAChC,GACA,CAACvC,EAAekB,IAElBsB,qBAAsBH,GACpB,SAAAI,GAAqB,IAAlB9B,EAAY8B,EAAZ9B,kBACaC,IAAVf,GACFa,EAAuBC,GAAgB,MAErCA,GACFR,SAAAA,EAAiBQ,GACjBZ,SAAAA,EAAWY,GACXO,EAAc,MAEdnB,SAAAA,EAAW,MACXmB,EAAc,IAEjB,GACD,CAACrB,EAAOM,EAAgBe,EAAenB,IAEzC2C,aAAc,SAACC,EAAOC,GACpB,OAAQA,EAAiBC,MACvB,KAAKtB,EAAYuB,iBAAiBC,kBAClC,KAAKxB,EAAYuB,iBAAiBE,UAChC,OAAAC,OAAAC,OAAAD,OAAAC,OAAA,GAAYN,EAAiBO,SAAO,CAAEZ,WAAY,GAAIP,QAASrC,IACjE,KAAK4B,EAAYuB,iBAAiBM,UAChC,OAAAH,OAAAC,OAAAD,OAAAC,OAAA,GAAYN,EAAiBO,UAASZ,WAAY,KAEpD,QACE,OAAOK,EAAiBO,QAE9B,IAlDAE,EAAK/B,EAAL+B,MAqDF,MAAO,CACLrB,OA9DMV,EAANU,OA+DAO,WA9DUjB,EAAViB,WA+DAe,iBA9DgBhC,EAAhBgC,iBA+DA3C,aAAAA,EACA4C,qBA/DoBjC,EAApBiC,qBAgEAC,cA/DalC,EAAbkC,cAgEAC,aA/DYnC,EAAZmC,aAgEAC,cA/DapC,EAAboC,cAgEAC,aA/DYrC,EAAZqC,aAgEAN,MAAO,gBACSzC,IAAVf,GACFa,EAAuB,MAEzB2C,IACAnC,EAAc,GACf,EACDD,gBAAAA,EACA2C,SAtEQtC,EAARsC,SAuEAC,WAtEUvC,EAAVuC,WAuEAC,UAtESxC,EAATwC,UAwEJ"}