import{slicedToArray as t}from"../../../_virtual/_rollupPluginBabelHelpers.js";import i from"classnames";import e,{forwardRef as r,useState as o,useMemo as n,useRef as l,useCallback as a,useEffect as s}from"react";import{noop as c}from"es-toolkit";import{VariableSizeList as u}from"react-window";import f from"react-virtualized-auto-sizer";import d from"../../hooks/usePrevious/index.js";import m from"../../hooks/useThrottledCallback.js";import v from"../../hooks/useMergeRef.js";import{getNormalizedItems as p,getMaxOffset as h,easeInOutQuint as I,getOnItemsRenderedData as S,isLayoutDirectionScrollbarVisible as g}from"../../services/virtualized-service.js";import{getTestId as T}from"../../tests/testIds.js";import{ComponentDefaultTestId as O}from"../../tests/constants.js";import z from"./VirtualizedList.module.scss.js";var b=r((function(r,b){var y=r.className,C=r.id,j=r.items,R=void 0===j?[]:j,w=r.itemRenderer,F=void 0===w?function(t,i,e){return t}:w,L=r.getItemHeight,x=void 0===L?function(t,i){return t.height}:L,k=r.getItemSize,V=void 0===k?null:k,A=r.layout,D=void 0===A?"vertical":A,E=r.onScroll,M=r.overscanCount,N=void 0===M?0:M,U=r.getItemId,_=void 0===U?function(t,i){return t.id}:U,q=r.scrollToId,H=r.scrollDuration,P=void 0===H?200:H,W=r.onScrollToFinished,B=void 0===W?c:W,Z=r.onItemsRendered,G=r.onItemsRenderedThrottleMs,J=void 0===G?200:G,K=r.onSizeUpdate,Q=void 0===K?c:K,X=r.onVerticalScrollbarVisiblityChange,Y=void 0===X?null:X,$=r.onLayoutDirectionScrollbarVisibilityChange,tt=void 0===$?null:$,it=r.virtualListRef,et=r.scrollableClassName,rt=r.role,ot=r.ariaLabel,nt=r.style,lt=r["data-testid"],at=o(0),st=t(at,2),ct=st[0],ut=st[1],ft=o(0),dt=t(ft,2),mt=dt[0],vt=dt[1],pt="horizontal"!==D,ht=n((function(){return pt?ct:mt}),[pt,ct,mt]),It=d(q),St=l(null),gt=l(null),Tt=l(null),Ot=l(0),zt=l({initialized:!1,scrollOffsetInitial:0,scrollOffsetFinal:0,animationStartTime:0}),bt=v(b,St),yt=v(it,Tt),Ct=zt.current;Ct.initialized||(Ct.initialized=!0,Ct.scrollOffsetInitial=0,Ct.scrollOffsetFinal=0,Ct.animationStartTime=0);var jt=a((function(t,i){var e=(V||x)(t,i);return void 0===e&&console.error("Couldn't get height for item: ",t),e}),[x,V]),Rt=a((function(t,i){var e=_(t,i);return void 0===e&&console.error("Couldn't get id for item: ",t),e}),[_]),wt=n((function(){return p(R,Rt,jt)}),[R,Rt,jt]),Ft=n((function(){return h(ht,wt)}),[ht,wt]),Lt=a((function(t){var i=t.scrollDirection,e=t.scrollOffset,r=t.scrollUpdateWasRequested;Ot.current=e,r||(Ct.scrollOffsetInitial=e),E&&E(i,e,r)}),[E,Ot,Ct]),xt=a((function(){requestAnimationFrame((function(){var t,i=performance.now()-Ct.animationStartTime,e=Ct.scrollOffsetFinal-Ct.scrollOffsetInitial,r=I(Math.min(1,i/P)),o=Math.min(Ft,Ct.scrollOffsetInitial+e*r);Ot.current=o,null===(t=Tt.current)||void 0===t||t.scrollTo(o),P>i?xt():(Ct.animationStartTime=void 0,B&&B())}))}),[P,Ct,Tt,Ft,B]),kt=a((function(t){var i,e,r,o,n=t.offsetTop;Ct.animationStartTime?Ct.scrollOffsetFinal=n:(null!==(null===(e=null===(i=Tt.current)||void 0===i?void 0:i.state)||void 0===e?void 0:e.scrollOffset)&&(Ct.scrollOffsetInitial=null===(o=null===(r=Tt.current)||void 0===r?void 0:r.state)||void 0===o?void 0:o.scrollOffset),Ct.scrollOffsetInitial!==n?(Ct.scrollOffsetFinal=n,Ct.animationStartTime=performance.now(),xt()):B&&B())}),[Ct,xt,B]),Vt=a((function(t){var i=t.index;return F(R[i],i,t.style)}),[R,F]),At=a((function(t){return jt(R[t],t)}),[R,jt]),Dt=a((function(t,i){i===ct&&t===mt||setTimeout((function(){ut(i),vt(t),Q(t,i)}),0)}),[ct,mt,Q]),Et=m((function(t){if(Z){var i=S(R,wt,Rt,t.visibleStartIndex,t.visibleStopIndex,ht,Ot.current);Z(i)}}),{wait:J,trailing:!0},[Z,R,wt,Rt,ht]);return s((function(){if(q&&It!==q){var t=g(R,wt,Rt,ht),i=wt[q];t&&i&&kt(i)}}),[It,q,kt,wt,R,Rt,ht]),s((function(){Tt.current&&Tt.current.resetAfterIndex(0)}),[wt]),s((function(){var t=tt||Y;if(t){var i=g(R,wt,Rt,ht);gt.current!==i&&(gt.current=i,t(i))}}),[tt,Y,R,wt,ht,Rt]),e.createElement("div",{ref:bt,className:i(z.virtualizedListWrapper,y),id:C,role:rt,"aria-label":ot,"data-testid":lt||T(O.VIRTUALIZED_LIST,C),style:nt},e.createElement(f,null,(function(t){var i=t.height,r=t.width;return Dt(r,i),e.createElement(u,{ref:yt,height:i,width:r,itemCount:R.length,itemSize:At,onScroll:Lt,layout:D,overscanCount:N,onItemsRendered:Et,className:et},Vt)})))}));export{b as default};
//# sourceMappingURL=VirtualizedList.js.map
